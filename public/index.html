<!DOCTYPE html>
<html>
<head>
<title>ğŸšš Pharma Transport Dashboard</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;margin:0;padding:20px}
.container{max-width:1200px;margin:auto;background:white;border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,0.1)}
h1{font-size:2.5em;color:#1a1a1a;text-align:center;margin-bottom:10px}
.subtitle{color:#666;text-align:center;margin-bottom:40px;font-size:1.2em}
.card{background:#f8f9fa;border-radius:15px;padding:25px;margin:15px 0;transition:transform 0.3s;box-shadow:0 5px 15px rgba(0,0,0,0.08)}
.card:hover{transform:translateY(-5px)}
.metric{font-size:2.5em;font-weight:700;color:#2d3748;margin:10px 0}
.green{color:#48bb78}
.red{color:#f56565}
.blue{color:#4299e1}
.vendor-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}
.status-badge{padding:8px 16px;border-radius:25px;font-weight:600;display:inline-block}
.live{background:#48bb78;color:white}
button{padding:12px 24px;background:#4299e1;color:white;border:none;border-radius:8px;font-size:16px;cursor:pointer;transition:background 0.3s}
button:hover{background:#3182ce}
</style>
</head>
<body>
<div class="container">
<h1>ğŸšš Pharma Transport Dashboard</h1>
<p class="subtitle">FDA 21 CFR Part 11 Compliant â€¢ Real-time Clinical Trial Tracking</p>

<div class="card" style="text-align:center">
<div style="font-size:1.5em;color:#48bb78">âœ… LIVE</div>
<button onclick="loadDashboard()">ğŸ“Š Load Metrics</button>
<button onclick="testLogin()">ğŸ” Test Login</button>
</div>

<div id="login-status" class="card" style="background:#e2e8f0">Click "Load Metrics" to begin...</div>
<div id="dashboard" style="display:none">
<div class="card">
<h2>ğŸ“ˆ Key Performance Indicators</h2>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px">
<div id="active-shipments" class="metric"></div>
<div id="otif" class="metric"></div>
<div id="co2" class="metric"></div>
<div id="exceptions" class="metric"></div>
</div>
</div>
<div class="card">
<h2>ğŸŒ¡ï¸ Temperature Compliance</h2>
<div id="temp-excursions" class="metric"></div>
</div>
<div class="card">
<h2>ğŸ“¦ Vendor Performance</h2>
<div id="vendors" class="vendor-grid"></div>
</div>
</div>
</div>

<script>
async function testLogin(){
  try{
    const res = await fetch('/api/auth/test-login', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({username:'testuser',password:'Pharma2026!'})
    });
    document.getElementById('login-status').innerHTML = 
      res.ok ? 'âœ… Login SUCCESS: testuser / Pharma2026!' : 'âŒ Login failed';
  }catch(e){
    document.getElementById('login-status').innerHTML = 'âŒ Network error';
  }
}

async function loadDashboard(){
  try{
    document.getElementById('login-status').innerHTML = 'ğŸ”„ Loading...';
    const data = await fetch('/api/v1/dashboard');
    const metrics = await data.json();
    
    document.getElementById('active-shipments').innerHTML = `ğŸšš ${metrics.active_shipments} Active Shipments`;
    document.getElementById('otif').innerHTML = `ğŸ“ˆ <span class="green">${metrics.otif_percent}%</span> OTIF`;
    document.getElementById('co2').innerHTML = `ğŸŒ± ${metrics.co2_month_kg.toLocaleString()}kg CO2`;
    document.getElementById('exceptions').innerHTML = `âš ï¸ ${metrics.exceptions_open} Open Exceptions`;
    document.getElementById('temp-excursions').innerHTML = `ğŸŒ¡ï¸ ${metrics.temp_excursions} Temp Excursions`;
    
    const vendorsHtml = metrics.vendors.map(v => 
      `<div class="card"><strong>${v.name}</strong><br><span class="blue">${v.otif}% OTIF</span></div>`
    ).join('');
    document.getElementById('vendors').innerHTML = vendorsHtml;
    
    document.getElementById('dashboard').style.display = 'block';
    document.getElementById('login-status').innerHTML = 
      `<span class="status-badge live">LIVE</span> Dashboard loaded successfully`;
  }catch(e){
    document.getElementById('login-status').innerHTML = 'âŒ API Error - Check server logs';
  }
}
</script>
</body>
</html>
